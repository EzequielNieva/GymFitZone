(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[48],{2834:function(e,r,o){Promise.resolve().then(o.bind(o,5420))},5420:function(e,r,o){"use strict";o.r(r);var t=o(7437),s=o(2265),n=o(7314),a=o(4422),l=o(2177),c=o(9376),i=o(2926);r.default=()=>{let{user:e}=(0,s.useContext)(l.S),r=(0,c.useRouter)(),[o,u]=(0,s.useState)(""),[d,g]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=new URL(window.location.href).searchParams.get("token");e&&u(e)},[]);let h=(0,n.TA)({initialValues:{newPassword:"",confirmPassword:""},validationSchema:a.Ry({newPassword:a.Z_().required("Requerido").min(8,"La contrase\xf1a debe tener al menos 8 caracteres"),confirmPassword:a.Z_().required("Requerido").oneOf([a.iH("newPassword")],"Las contrase\xf1as deben coincidir")}),onSubmit:async e=>{g(!0);try{(await fetch("http://localhost:3000/auth/reset-password?token=".concat(o),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({newPassword:e.newPassword,confirmPassword:e.confirmPassword})})).ok?(alert("Password successfully changed"),r.push("/login")):alert("Error when changing password")}catch(e){console.error(e),alert("Error when changing password")}finally{g(!1)}}});return d?(0,t.jsx)(i.Z,{}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-black text-white",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Change Password"}),(0,t.jsxs)("form",{onSubmit:h.handleSubmit,className:"bg-gray-800 p-6 rounded-md shadow-md w-96",children:[(0,t.jsx)("input",{id:"newPassword",name:"newPassword",type:"password",placeholder:"New Password",onChange:h.handleChange,value:h.values.newPassword,className:"mb-4 p-2 w-full bg-black border-2 border-red-600 text-white placeholder-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-red-600"}),h.touched.newPassword&&h.errors.newPassword?(0,t.jsx)("div",{className:"text-red-600",children:h.errors.newPassword}):null,(0,t.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:"password",placeholder:"Confirm Password",onChange:h.handleChange,value:h.values.confirmPassword,className:"mb-4 p-2 w-full bg-black border-2 border-red-600 text-white placeholder-gray-400 rounded-md focus:outline-none focus:ring-2 focus:ring-red-600"}),h.touched.confirmPassword&&h.errors.confirmPassword?(0,t.jsx)("div",{className:"text-red-600",children:h.errors.confirmPassword}):null,(0,t.jsx)("button",{type:"submit",className:"w-full bg-red-600 text-white py-2 rounded-md hover:bg-red-700 transition duration-200",children:"Change Password"})]})]})}},2926:function(e,r,o){"use strict";var t=o(7437);o(2265);var s=o(2574);r.Z=()=>(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-black",children:(0,t.jsx)(s.p2,{height:80,width:80,color:"#FF0000",ariaLabel:"loading",visible:!0})})},2177:function(e,r,o){"use strict";o.d(r,{S:function(){return d},d:function(){return g}});var t=o(7437),s=o(9261),n=o(2265),a=o(4474),l=o(5515),c=o.n(l),i=o(9376),u=o(605);let d=(0,n.createContext)({user:null,setUser:()=>{},isLogged:!1,setIsLogged:()=>{},signIn:async()=>!1,signUp:async e=>({success:!1,errorMessage:""}),logOut:()=>{},imgUrl:null,setImgUrl:()=>{}}),g=e=>{let{children:r}=e,[o,l]=(0,n.useState)(null),[g,h]=(0,n.useState)(!1),[w,m]=(0,n.useState)(null);(0,i.useRouter)();let{data:f,status:p}=(0,u.useSession)();console.log("\uD83D\uDE80 ~ UserProvider ~ status:",p),console.log("\uD83D\uDE80 ~ UserProvider ~ session:",f);let b=async e=>{try{let r;if("provider"in e)return!0;{let o=await (0,s.Qd)(e);r=o?{user:o.user,token:o.token}:null}if(r&&r.token){let e=(0,a.o)(r.token),o=e.roles,t=e.id,n={...r.user,role:o,id:t,token:r.token},c=await (0,s.FQ)(t,r.token);return c&&(l({...n,...c}),m(c.imgUrl||null),localStorage.setItem("imgUrl_".concat(t),c.imgUrl||"")),localStorage.setItem("user",JSON.stringify(n)),localStorage.setItem("token",r.token),h(!0),!0}return console.warn("No se pudo iniciar sesi\xf3n, datos no v\xe1lidos:",r),!1}catch(e){return e instanceof Error?console.error("Error durante el login:",e.message):console.error("Error inesperado durante el login:",e),!1}},y=async e=>{try{console.log("Llamando a postSignUp con:",e);let r=await (0,s.J)(e);if(console.log("Respuesta recibida en signUp:",r),r&&r.user&&r.user.id)return console.log("Usuario registrado correctamente:",r.user),await b({email:e.email,password:e.password}),m(r.user.imgUrl),{success:!0};return console.log("La respuesta no contiene el usuario o el ID:",r),{success:!1,errorMessage:"No se pudo obtener el ID del usuario."}}catch(e){return console.error("Error en signUp:",e),{success:!1,errorMessage:e instanceof Error?e.message:"Error desconocido en el registro"}}},P=async()=>{let e=null==o?void 0:o.id;e&&localStorage.removeItem("imgUrl_".concat(e)),localStorage.removeItem("user"),localStorage.removeItem("token"),c().fire({title:"Come back soon!",text:"You are logged out!",icon:"success",confirmButtonText:"Great",customClass:{popup:"bg-black text-white",title:"text-red-600",confirmButton:"bg-red-600 text-white hover:bg-red-700 py-2 px-4 border-none rounded-md"},buttonsStyling:!1}),l(null),h(!1),m(null)};return(0,n.useEffect)(()=>{let e=localStorage.getItem("user"),r=localStorage.getItem("token");if(e&&r){let o=JSON.parse(e);try{let e=(0,a.o)(r),t=e.roles,s=o.id,n=localStorage.getItem("imgUrl_".concat(s));l({...o,role:t,id:e.id}),m(n||null),h(!0)}catch(e){console.warn("Error al decodificar el token:",e)}}},[]),(0,t.jsx)(d.Provider,{value:{user:o,setUser:l,isLogged:g,setIsLogged:h,signIn:b,signUp:y,logOut:P,imgUrl:w,setImgUrl:m},children:r})}},9261:function(e,r,o){"use strict";async function t(e){try{if(!e.email||!e.password)return console.error("Email y contrase\xf1a son obligatorios"),null;let r=await fetch("http://localhost:3000/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json();throw console.error("Error del servidor:",e),Error("Error: ".concat(r.status," ").concat(r.statusText))}return await r.json()}catch(e){return e instanceof Error?console.error("Error durante la solicitud de inicio de sesi\xf3n:",e.message):console.error("Error inesperado:",e),null}}async function s(e){try{console.log("Iniciando la solicitud de registro al backend");let r=await fetch("http://localhost:3000/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json();throw console.error("Error del servidor:",e),Error("Error: ".concat(r.status," ").concat(r.statusText))}let o=await r.json();return console.log("Respuesta del servidor:",o),o}catch(e){return console.error("Error durante el registro:",e),null}}o.d(r,{FQ:function(){return l},J:function(){return s},Qd:function(){return t},Rf:function(){return n},wc:function(){return a}});let n=async()=>{let e=localStorage.getItem("token"),r=await fetch("http://localhost:3000/users",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(!r.ok){let e=await r.json();throw Error("HTTP error! Status: ".concat(r.status,", Message: ").concat(e.message))}return await r.json()},a=async(e,r)=>{let o=localStorage.getItem("token");if(!o)throw Error("Token no encontrado");let t=await fetch("http://localhost:3000/users/changeRole/".concat(e,"?role=").concat(r),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)}});if(!t.ok)throw Error((await t.json()).message||"Error desconocido al cambiar el rol");return await t.json()},l=async(e,r)=>{try{let o=await fetch("http://localhost:3000/users/".concat(e),{headers:{Authorization:"Bearer ".concat(r)}});if(o.ok)return await o.json();return console.error("Error fetching user data:",o.statusText),null}catch(e){return console.error("Error fetching user data:",e),null}}}},function(e){e.O(0,[461,571,598,546,840,971,117,744],function(){return e(e.s=2834)}),_N_E=e.O()}]);