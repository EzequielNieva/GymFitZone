(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{4862:function(e,t,r){Promise.resolve().then(r.t.bind(r,5878,23)),Promise.resolve().then(r.t.bind(r,6157,23)),Promise.resolve().then(r.t.bind(r,3716,23)),Promise.resolve().then(r.t.bind(r,2778,23)),Promise.resolve().then(r.bind(r,5978)),Promise.resolve().then(r.bind(r,6464)),Promise.resolve().then(r.bind(r,8738))},5978:function(e,t,r){"use strict";r.d(t,{Providers:function(){return l}});var s=r(7437),o=r(605),n=r(2177);function l(e){let{children:t}=e;return(0,s.jsx)(o.SessionProvider,{children:(0,s.jsx)(n.d,{children:t})})}},6464:function(e,t,r){"use strict";r.d(t,{default:function(){return h}});var s=r(7437),o=r(2265),n=r(3145),l=r(7648),a=r(8738),i=r(9376),c=r(2177),u=e=>{let{isOpen:t,onClose:r,onAccept:o,children:n}=e;return t?(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-75",children:(0,s.jsxs)("div",{className:"bg-neutral-900 rounded-lg p-6 max-w-md w-full",children:[(0,s.jsx)("h2",{className:"text-white text-lg font-mediummb-4 text-center mb-7",children:n}),(0,s.jsxs)("div",{className:"flex justify-center",children:[(0,s.jsx)("button",{onClick:o,className:"bg-red-600 hover:bg-red-500 text-white font-semibold py-2 px-4 rounded me-5",children:"Accept"}),(0,s.jsx)("button",{onClick:r,className:"bg-white text-black font-semibold py-2 px-4 rounded hover:bg-gray-200 ms-5",children:"Cancel"})]})]})}):null},d=r(5515),m=r.n(d),h=()=>{let{user:e,logOut:t,isLogged:r,imgUrl:d,setImgUrl:h}=(0,o.useContext)(c.S),[f,g]=(0,o.useState)(!1),x=(0,o.useRef)(null),p=(0,i.usePathname)(),b=(0,i.useRouter)(),[w,j]=(0,o.useState)(null),[v,y]=(0,o.useState)(!1),A=async()=>{if(!w||!e)return;let t=new FormData;t.append("file",w),y(!1),j(null);try{let r=await fetch("http://localhost:3000/files/profileImages/".concat(e.id),{method:"POST",body:t});if(r.ok){let t=await r.json();h(()=>t.imgUrl);let s=e.id;localStorage.setItem("imgUrl_".concat(s),t.imgUrl),m().fire({title:"Super!",text:"Profile photo updated successfully!",icon:"success",customClass:{popup:"bg-black text-white",title:"text-red-600",confirmButton:"bg-red-600 text-white hover:bg-red-700 py-2 px-4 border-none rounded-md"},buttonsStyling:!1}),g(!1)}else{let e=await r.json();console.error("Error details:",e),m().fire({title:"Mmm...",text:"Failed to upload profile photo: ".concat(e.message||"Unknown error"),icon:"error",customClass:{popup:"bg-black text-white",title:"text-red-600",confirmButton:"bg-red-600 text-white hover:bg-red-700 py-2 px-4 border-none"},buttonsStyling:!1})}}catch(e){console.error("Error uploading file:",e),m().fire({title:"Mmm...",text:"Error when uploading the file.",icon:"error",customClass:{popup:"bg-black text-white",title:"text-red-600",confirmButton:"bg-red-600 text-white hover:bg-red-700 py-2 px-4 border-none"},buttonsStyling:!1})}};return(0,o.useEffect)(()=>{r&&b.push("/home")},[r,b]),(0,o.useEffect)(()=>{let e=e=>{x.current&&!x.current.contains(e.target)&&g(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,s.jsxs)("header",{className:"flex items-center justify-between p-4 bg-black text-white shadow-md",children:[(0,s.jsxs)(l.default,{href:"/",className:"flex items-center",children:[(0,s.jsx)(n.default,{src:a.default,alt:"logo",width:60,height:60}),(0,s.jsx)("div",{className:"ml-4 text-2xl font-bold",children:"FitZone"})]}),(null==e?void 0:e.role)==="user"?(0,s.jsx)("nav",{className:"flex-1 flex items-center justify-center",children:(0,s.jsx)("ul",{className:"flex space-x-6 list-none m-0 p-0 items-center justify-center flex-grow",children:["Classes","Plans","Appointments","Training Plans"].map((e,t)=>{let r=e.toLowerCase(),o="classes"===r?"/home":"plans"===r?"/plans":"appointments"===r?"/appointments":"/training-plans";return(0,s.jsxs)("li",{className:"relative group",children:[(0,s.jsx)(l.default,{href:o,className:"text-white text-sm sm:text-base font-medium px-3 py-2",children:e}),(0,s.jsx)("span",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-red-600 transition-transform duration-300 ".concat(p===o?"scale-x-100":"scale-x-0")}),(0,s.jsx)("span",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-red-600 transition-transform duration-300 scale-x-0 group-hover:scale-x-100"})]},t)})})}):(null==e?void 0:e.role)==="admin"?(0,s.jsx)("nav",{className:"flex-1 flex items-center justify-center",children:(0,s.jsx)("ul",{className:"flex space-x-6 list-none m-0 p-0 items-center justify-center flex-grow",children:["Users","Coaches","Admins","Classes"].map((e,t)=>{let r=e.toLowerCase(),o="users"===r?"/users":"coaches"===r?"/coaches":"admins"===r?"/admins":"/classes";return(0,s.jsxs)("li",{className:"relative group",children:[(0,s.jsx)(l.default,{href:o,className:"text-white text-sm sm:text-base font-medium px-3 py-2",children:e}),(0,s.jsx)("span",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-red-600 transition-transform duration-300 ".concat(p===o?"scale-x-100":"scale-x-0")}),(0,s.jsx)("span",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-red-600 transition-transform duration-300 scale-x-0 group-hover:scale-x-100"})]},t)})})}):(null==e?void 0:e.role)==="coach"?(0,s.jsx)("nav",{className:"flex-1 flex items-center justify-center",children:(0,s.jsx)("ul",{className:"flex space-x-6 list-none m-0 p-0 items-center justify-center flex-grow",children:["Training Management"].map((e,t)=>{let r="training management"===e.toLowerCase()?"/training-management":"#";return(0,s.jsxs)("li",{className:"relative group",children:[(0,s.jsx)(l.default,{href:r,className:"text-white text-sm sm:text-base font-medium px-3 py-2",children:e}),(0,s.jsx)("span",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-red-600 transition-transform duration-300 ".concat(p===r?"scale-x-100":"scale-x-0")}),(0,s.jsx)("span",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-red-600 transition-transform duration-300 scale-x-0 group-hover:scale-x-100"})]},t)})})}):r?null:(0,s.jsx)("nav",{className:"flex-1 flex items-center justify-center",children:(0,s.jsx)("ul",{className:"flex space-x-6 list-none m-0 p-0 items-center justify-center flex-grow",children:["Classes","Plans"].map((e,t)=>{let r="classes"===e.toLowerCase()?"/home":"/plans";return(0,s.jsxs)("li",{className:"relative group",children:[(0,s.jsx)(l.default,{href:r,className:"text-white text-sm sm:text-base font-medium px-3 py-2",children:e}),(0,s.jsx)("span",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-red-600 transition-transform duration-300 ".concat(p===r?"scale-x-100":"scale-x-0")}),(0,s.jsx)("span",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-red-600 transition-transform duration-300 scale-x-0 group-hover:scale-x-100"})]},t)})})}),r?(0,s.jsxs)("div",{className:"relative",ref:x,children:[(0,s.jsx)("div",{className:"w-14 h-14 rounded-full cursor-pointer transition-transform duration-200 hover:scale-105 me-5",onClick:()=>{g(e=>!e)},children:(0,s.jsx)("img",{src:d||"https://i.postimg.cc/Ssxqc09d/Dise-o-sin-t-tulo-17-removebg-preview.png",alt:"avatar",className:"w-full h-full rounded-full"})}),(0,s.jsx)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg transition-all duration-600 ease-in-out ".concat(f?"opacity-100 scale-100":"opacity-0 scale-95 pointer-events-none"),children:f&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"px-4 py-2 text-black",children:[(0,s.jsx)("p",{className:"font-medium",children:null==e?void 0:e.name}),(0,s.jsx)("p",{className:"font-light",children:null==e?void 0:e.email})]}),(0,s.jsx)("button",{onClick:()=>{t(),g(!1),b.push("/")},className:"w-full px-4 py-2 text-left text-red-600 hover:bg-red-100",children:"Log Out"}),(0,s.jsx)("button",{onClick:()=>{var e;return null===(e=document.getElementById("fileInput"))||void 0===e?void 0:e.click()},className:"w-full px-4 py-2 text-left text-black hover:bg-red-100",children:"Change profile photo"}),(0,s.jsx)("input",{type:"file",id:"fileInput",style:{display:"none"},accept:"image/*",onChange:e=>{e.target.files&&e.target.files.length>0&&(j(e.target.files[0]),y(!0))}})]})})]}):(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(l.default,{href:"/login",className:"text-white text-sm sm:text-base font-medium px-3 py-2",children:"Sign In"}),(0,s.jsx)(l.default,{href:"/register",className:"text-lg font-medium px-4 py-2 rounded-md bg-red-600 text-white shadow-md hover:bg-red-800 transition-colors",children:"Sign Up"})]}),(0,s.jsx)(u,{isOpen:v,onClose:()=>{y(!1),j(null)},onAccept:A,children:"Are you sure you want to change your photo?"})]})}},2177:function(e,t,r){"use strict";r.d(t,{S:function(){return d},d:function(){return m}});var s=r(7437),o=r(9261),n=r(2265),l=r(4474),a=r(5515),i=r.n(a),c=r(9376),u=r(605);let d=(0,n.createContext)({user:null,setUser:()=>{},isLogged:!1,setIsLogged:()=>{},signIn:async()=>!1,signUp:async e=>({success:!1,errorMessage:""}),logOut:()=>{},imgUrl:null,setImgUrl:()=>{}}),m=e=>{let{children:t}=e,[r,a]=(0,n.useState)(null),[m,h]=(0,n.useState)(!1),[f,g]=(0,n.useState)(null);(0,c.useRouter)();let{data:x,status:p}=(0,u.useSession)();console.log("\uD83D\uDE80 ~ UserProvider ~ status:",p),console.log("\uD83D\uDE80 ~ UserProvider ~ session:",x);let b=async e=>{try{let t;if("provider"in e)return!0;{let r=await (0,o.Qd)(e);t=r?{user:r.user,token:r.token}:null}if(t&&t.token){let e=(0,l.o)(t.token),r=e.roles,s=e.id,n={...t.user,role:r,id:s,token:t.token},i=await (0,o.FQ)(s,t.token);return i&&(a({...n,...i}),g(i.imgUrl||null),localStorage.setItem("imgUrl_".concat(s),i.imgUrl||"")),localStorage.setItem("user",JSON.stringify(n)),localStorage.setItem("token",t.token),h(!0),!0}return console.warn("No se pudo iniciar sesi\xf3n, datos no v\xe1lidos:",t),!1}catch(e){return e instanceof Error?console.error("Error durante el login:",e.message):console.error("Error inesperado durante el login:",e),!1}},w=async e=>{try{console.log("Llamando a postSignUp con:",e);let t=await (0,o.J)(e);if(console.log("Respuesta recibida en signUp:",t),t&&t.user&&t.user.id)return console.log("Usuario registrado correctamente:",t.user),await b({email:e.email,password:e.password}),g(t.user.imgUrl),{success:!0};return console.log("La respuesta no contiene el usuario o el ID:",t),{success:!1,errorMessage:"No se pudo obtener el ID del usuario."}}catch(e){return console.error("Error en signUp:",e),{success:!1,errorMessage:e instanceof Error?e.message:"Error desconocido en el registro"}}},j=async()=>{let e=null==r?void 0:r.id;e&&localStorage.removeItem("imgUrl_".concat(e)),localStorage.removeItem("user"),localStorage.removeItem("token"),i().fire({title:"Come back soon!",text:"You are logged out!",icon:"success",confirmButtonText:"Great",customClass:{popup:"bg-black text-white",title:"text-red-600",confirmButton:"bg-red-600 text-white hover:bg-red-700 py-2 px-4 border-none rounded-md"},buttonsStyling:!1}),a(null),h(!1),g(null)};return(0,n.useEffect)(()=>{let e=localStorage.getItem("user"),t=localStorage.getItem("token");if(e&&t){let r=JSON.parse(e);try{let e=(0,l.o)(t),s=e.roles,o=r.id,n=localStorage.getItem("imgUrl_".concat(o));a({...r,role:s,id:e.id}),g(n||null),h(!0)}catch(e){console.warn("Error al decodificar el token:",e)}}},[]),(0,s.jsx)(d.Provider,{value:{user:r,setUser:a,isLogged:m,setIsLogged:h,signIn:b,signUp:w,logOut:j,imgUrl:f,setImgUrl:g},children:t})}},9261:function(e,t,r){"use strict";async function s(e){try{if(!e.email||!e.password)return console.error("Email y contrase\xf1a son obligatorios"),null;let t=await fetch("http://localhost:3000/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw console.error("Error del servidor:",e),Error("Error: ".concat(t.status," ").concat(t.statusText))}return await t.json()}catch(e){return e instanceof Error?console.error("Error durante la solicitud de inicio de sesi\xf3n:",e.message):console.error("Error inesperado:",e),null}}async function o(e){try{console.log("Iniciando la solicitud de registro al backend");let t=await fetch("http://localhost:3000/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw console.error("Error del servidor:",e),Error("Error: ".concat(t.status," ").concat(t.statusText))}let r=await t.json();return console.log("Respuesta del servidor:",r),r}catch(e){return console.error("Error durante el registro:",e),null}}r.d(t,{FQ:function(){return a},J:function(){return o},Qd:function(){return s},Rf:function(){return n},wc:function(){return l}});let n=async()=>{let e=localStorage.getItem("token"),t=await fetch("http://localhost:3000/users",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(!t.ok){let e=await t.json();throw Error("HTTP error! Status: ".concat(t.status,", Message: ").concat(e.message))}return await t.json()},l=async(e,t)=>{let r=localStorage.getItem("token");if(!r)throw Error("Token no encontrado");let s=await fetch("http://localhost:3000/users/changeRole/".concat(e,"?role=").concat(t),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}});if(!s.ok)throw Error((await s.json()).message||"Error desconocido al cambiar el rol");return await s.json()},a=async(e,t)=>{try{let r=await fetch("http://localhost:3000/users/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}});if(r.ok)return await r.json();return console.error("Error fetching user data:",r.statusText),null}catch(e){return console.error("Error fetching user data:",e),null}}},2778:function(){},8738:function(e,t,r){"use strict";r.r(t),t.default={src:"/_next/static/media/icono-principal.1616a8ee.png",height:500,width:500,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAIVBMVEX5AADxBwbxBgTxBgX3AgL2AwPzAAD4AwPyAAD6AQLwCAi6xnEHAAAAC3RSTlMBPSxQm3AOshSIWwYSdCIAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAxSURBVHicZYoxDgAgCMS4OxDw/w82mDjZoelQsw85tekyuIciYcgOTBTZLKzZ1vXjABNtAJRbZPm1AAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8}}},function(e){e.O(0,[344,799,986,461,598,648,377,971,117,744],function(){return e(e.s=4862)}),_N_E=e.O()}]);