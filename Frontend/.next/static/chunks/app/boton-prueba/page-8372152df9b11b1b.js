(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[507],{4512:function(e,r,t){Promise.resolve().then(t.bind(t,7691))},7691:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return c}});var o=t(7437),n=t(2265),s=t(9376),a=t(2177),l=t(4474),i=t(2926);function c(e){let{searchParams:r}=e,t=(0,s.useRouter)(),{setIsLogged:c,setUser:u}=(0,n.useContext)(a.S),[d,g]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{let e=null==r?void 0:r.token;if(e){localStorage.setItem("token",e);let r=(0,l.o)(e);switch(u({id:r.id,email:r.email,role:r.role}),c(!0),g(!1),r.role){case"admin":t.push("/users");break;case"coach":t.push("/training-management");break;case"user":t.push("/home");break;default:t.push("/")}}else g(!1)},[r,t,c,u]),d)?(0,o.jsx)(i.Z,{}):(0,o.jsx)("div",{children:"Redirecting..."})}},2926:function(e,r,t){"use strict";var o=t(7437);t(2265);var n=t(2574);r.Z=()=>(0,o.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-black",children:(0,o.jsx)(n.p2,{height:80,width:80,color:"#FF0000",ariaLabel:"loading",visible:!0})})},2177:function(e,r,t){"use strict";t.d(r,{S:function(){return d},d:function(){return g}});var o=t(7437),n=t(9261),s=t(2265),a=t(4474),l=t(5515),i=t.n(l),c=t(9376),u=t(605);let d=(0,s.createContext)({user:null,setUser:()=>{},isLogged:!1,setIsLogged:()=>{},signIn:async()=>!1,signUp:async e=>({success:!1,errorMessage:""}),logOut:()=>{},imgUrl:null,setImgUrl:()=>{}}),g=e=>{let{children:r}=e,[t,l]=(0,s.useState)(null),[g,h]=(0,s.useState)(!1),[f,m]=(0,s.useState)(null);(0,c.useRouter)();let{data:p,status:w}=(0,u.useSession)();console.log("\uD83D\uDE80 ~ UserProvider ~ status:",w),console.log("\uD83D\uDE80 ~ UserProvider ~ session:",p);let k=async e=>{try{let r;if("provider"in e)return!0;{let t=await (0,n.Qd)(e);r=t?{user:t.user,token:t.token}:null}if(r&&r.token){let e=(0,a.o)(r.token),t=e.roles,o=e.id,s={...r.user,role:t,id:o,token:r.token},i=await (0,n.FQ)(o,r.token);return i&&(l({...s,...i}),m(i.imgUrl||null),localStorage.setItem("imgUrl_".concat(o),i.imgUrl||"")),localStorage.setItem("user",JSON.stringify(s)),localStorage.setItem("token",r.token),h(!0),!0}return console.warn("No se pudo iniciar sesi\xf3n, datos no v\xe1lidos:",r),!1}catch(e){return e instanceof Error?console.error("Error durante el login:",e.message):console.error("Error inesperado durante el login:",e),!1}},E=async e=>{try{console.log("Llamando a postSignUp con:",e);let r=await (0,n.J)(e);if(console.log("Respuesta recibida en signUp:",r),r&&r.user&&r.user.id)return console.log("Usuario registrado correctamente:",r.user),await k({email:e.email,password:e.password}),m(r.user.imgUrl),{success:!0};return console.log("La respuesta no contiene el usuario o el ID:",r),{success:!1,errorMessage:"No se pudo obtener el ID del usuario."}}catch(e){return console.error("Error en signUp:",e),{success:!1,errorMessage:e instanceof Error?e.message:"Error desconocido en el registro"}}},y=async()=>{let e=null==t?void 0:t.id;e&&localStorage.removeItem("imgUrl_".concat(e)),localStorage.removeItem("user"),localStorage.removeItem("token"),i().fire({title:"Come back soon!",text:"You are logged out!",icon:"success",confirmButtonText:"Great",customClass:{popup:"bg-black text-white",title:"text-red-600",confirmButton:"bg-red-600 text-white hover:bg-red-700 py-2 px-4 border-none rounded-md"},buttonsStyling:!1}),l(null),h(!1),m(null)};return(0,s.useEffect)(()=>{let e=localStorage.getItem("user"),r=localStorage.getItem("token");if(e&&r){let t=JSON.parse(e);try{let e=(0,a.o)(r),o=e.roles,n=t.id,s=localStorage.getItem("imgUrl_".concat(n));l({...t,role:o,id:e.id}),m(s||null),h(!0)}catch(e){console.warn("Error al decodificar el token:",e)}}},[]),(0,o.jsx)(d.Provider,{value:{user:t,setUser:l,isLogged:g,setIsLogged:h,signIn:k,signUp:E,logOut:y,imgUrl:f,setImgUrl:m},children:r})}},9261:function(e,r,t){"use strict";async function o(e){try{if(!e.email||!e.password)return console.error("Email y contrase\xf1a son obligatorios"),null;let r=await fetch("http://localhost:3000/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json();throw console.error("Error del servidor:",e),Error("Error: ".concat(r.status," ").concat(r.statusText))}return await r.json()}catch(e){return e instanceof Error?console.error("Error durante la solicitud de inicio de sesi\xf3n:",e.message):console.error("Error inesperado:",e),null}}async function n(e){try{console.log("Iniciando la solicitud de registro al backend");let r=await fetch("http://localhost:3000/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json();throw console.error("Error del servidor:",e),Error("Error: ".concat(r.status," ").concat(r.statusText))}let t=await r.json();return console.log("Respuesta del servidor:",t),t}catch(e){return console.error("Error durante el registro:",e),null}}t.d(r,{FQ:function(){return l},J:function(){return n},Qd:function(){return o},Rf:function(){return s},wc:function(){return a}});let s=async()=>{let e=localStorage.getItem("token"),r=await fetch("http://localhost:3000/users",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(!r.ok){let e=await r.json();throw Error("HTTP error! Status: ".concat(r.status,", Message: ").concat(e.message))}return await r.json()},a=async(e,r)=>{let t=localStorage.getItem("token");if(!t)throw Error("Token no encontrado");let o=await fetch("http://localhost:3000/users/changeRole/".concat(e,"?role=").concat(r),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(!o.ok)throw Error((await o.json()).message||"Error desconocido al cambiar el rol");return await o.json()},l=async(e,r)=>{try{let t=await fetch("http://localhost:3000/users/".concat(e),{headers:{Authorization:"Bearer ".concat(r)}});if(t.ok)return await t.json();return console.error("Error fetching user data:",t.statusText),null}catch(e){return console.error("Error fetching user data:",e),null}}}},function(e){e.O(0,[461,571,598,840,971,117,744],function(){return e(e.s=4512)}),_N_E=e.O()}]);