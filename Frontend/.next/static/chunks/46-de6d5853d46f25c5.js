"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[46],{3046:function(e,t,r){var o=r(7437),n=r(551),a=r(2265),s=r(4810),l=r.n(s),i=r(5515),c=r.n(i),u=r(2177);t.default=()=>{let{user:e}=(0,a.useContext)(u.S),[t,r]=(0,a.useState)([]),[s,i]=(0,a.useState)(null),[d,g]=(0,a.useState)(!0),[h,p]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{g(!0);try{let e=await (0,n.pE)();r(e)}catch(e){i("Error fetching training plans")}finally{g(!1)}})()},[]);let m=async e=>{(await c().fire({title:"Hey!",text:"Are you sure you want to delete this plan?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No",customClass:{popup:"bg-[#222222] text-white",title:"text-[#B0E9FF]",confirmButton:"bg-[#B0E9FF] text-[#222222] hover:bg-[#6aa4bb] py-2 px-4 border-none",cancelButton:"bg-gray-500 text-white hover:bg-gray-600 py-2 px-4 border-none"},buttonsStyling:!1})).isConfirmed&&await (0,n.Wb)(e)&&(r(t.filter(t=>t.id!==e)),c().fire({title:"Great!",text:"The plan has been deleted successfully!",icon:"success",customClass:{popup:"bg-[#222222] text-white",title:"text-[#B0E9FF]",confirmButton:"bg-[#B0E9FF] text-[#222222] hover:bg-[#6aa4bb] py-2 px-4 border-none"},buttonsStyling:!1}))},f=e=>{p(e)},w=()=>{p(null)};return d?(0,o.jsx)("div",{children:"Loading training plans..."}):s?(0,o.jsx)("div",{className:"text-red-500",children:s}):(0,o.jsxs)("div",{className:"min-h-screen bg-black text-white flex flex-col items-center p-6",children:[(0,o.jsx)("div",{className:"text-center mb-6",children:(0,o.jsxs)("h1",{className:"text-3xl font-extrabold",children:["My ",(0,o.jsx)("span",{className:"text-red-600",children:"Training Plans"})]})}),(0,o.jsx)("div",{className:"text-center container mx-auto p-8 bg-zinc-950 shadow-lg",children:0===t.length?(0,o.jsx)("p",{children:"No training plans available"}):(0,o.jsx)("ul",{children:t.map(t=>(0,o.jsxs)("li",{className:"bg-zinc-900 p-4 rounded-lg shadow-md mb-4 flex justify-between items-center",children:[(0,o.jsx)("h2",{className:"text-lg font-semibold",children:t.description}),(0,o.jsxs)("div",{className:"flex space-x-4",children:[(0,o.jsx)("button",{onClick:()=>f(t.file),className:"bg-gray-700 text-white py-2 px-4 rounded hover:bg-gray-800 transition",children:"View Plan"}),(null==e?void 0:e.role)==="coach"&&(0,o.jsx)("button",{onClick:()=>m(t.id),className:"bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition",children:"Delete Plan"})]})]},t.id))})}),(0,o.jsx)(l(),{isOpen:!!h,onRequestClose:w,className:"flex items-center justify-center",overlayClassName:"fixed inset-0 bg-black bg-opacity-50",children:(0,o.jsxs)("div",{className:"bg-white p-4 rounded",children:[h&&(0,o.jsx)("img",{src:h,alt:"Training Plan",className:"max-w-full h-auto"}),(0,o.jsx)("button",{onClick:w,className:"mt-4 bg-gray-500 text-white py-1 px-3 rounded hover:bg-gray-600",children:"Close"})]})})]})}},2177:function(e,t,r){r.d(t,{S:function(){return d},d:function(){return g}});var o=r(7437),n=r(9261),a=r(2265),s=r(4474),l=r(5515),i=r.n(l),c=r(9376),u=r(605);let d=(0,a.createContext)({user:null,setUser:()=>{},isLogged:!1,setIsLogged:()=>{},signIn:async()=>!1,signUp:async e=>({success:!1,errorMessage:""}),logOut:()=>{},imgUrl:null,setImgUrl:()=>{}}),g=e=>{let{children:t}=e,[r,l]=(0,a.useState)(null),[g,h]=(0,a.useState)(!1),[p,m]=(0,a.useState)(null);(0,c.useRouter)();let{data:f,status:w}=(0,u.useSession)();console.log("\uD83D\uDE80 ~ UserProvider ~ status:",w),console.log("\uD83D\uDE80 ~ UserProvider ~ session:",f);let x=async e=>{try{let t;if("provider"in e)return!0;{let r=await (0,n.Qd)(e);t=r?{user:r.user,token:r.token}:null}if(t&&t.token){let e=(0,s.o)(t.token),r=e.roles,o=e.id,a={...t.user,role:r,id:o,token:t.token},i=await (0,n.FQ)(o,t.token);return i&&(l({...a,...i}),m(i.imgUrl||null),localStorage.setItem("imgUrl_".concat(o),i.imgUrl||"")),localStorage.setItem("user",JSON.stringify(a)),localStorage.setItem("token",t.token),h(!0),!0}return console.warn("No se pudo iniciar sesi\xf3n, datos no v\xe1lidos:",t),!1}catch(e){return e instanceof Error?console.error("Error durante el login:",e.message):console.error("Error inesperado durante el login:",e),!1}},y=async e=>{try{console.log("Llamando a postSignUp con:",e);let t=await (0,n.J)(e);if(console.log("Respuesta recibida en signUp:",t),t&&t.user&&t.user.id)return console.log("Usuario registrado correctamente:",t.user),await x({email:e.email,password:e.password}),m(t.user.imgUrl),{success:!0};return console.log("La respuesta no contiene el usuario o el ID:",t),{success:!1,errorMessage:"No se pudo obtener el ID del usuario."}}catch(e){return console.error("Error en signUp:",e),{success:!1,errorMessage:e instanceof Error?e.message:"Error desconocido en el registro"}}},b=async()=>{let e=null==r?void 0:r.id;e&&localStorage.removeItem("imgUrl_".concat(e)),localStorage.removeItem("user"),localStorage.removeItem("token"),i().fire({title:"Come back soon!",text:"You are logged out!",icon:"success",confirmButtonText:"Great",customClass:{popup:"bg-black text-white",title:"text-red-600",confirmButton:"bg-red-600 text-white hover:bg-red-700 py-2 px-4 border-none rounded-md"},buttonsStyling:!1}),l(null),h(!1),m(null)};return(0,a.useEffect)(()=>{let e=localStorage.getItem("user"),t=localStorage.getItem("token");if(e&&t){let r=JSON.parse(e);try{let e=(0,s.o)(t),o=e.roles,n=r.id,a=localStorage.getItem("imgUrl_".concat(n));l({...r,role:o,id:e.id}),m(a||null),h(!0)}catch(e){console.warn("Error al decodificar el token:",e)}}},[]),(0,o.jsx)(d.Provider,{value:{user:r,setUser:l,isLogged:g,setIsLogged:h,signIn:x,signUp:y,logOut:b,imgUrl:p,setImgUrl:m},children:t})}},551:function(e,t,r){async function o(e){try{let t=localStorage.getItem("token");if(!t)throw Error("Token no disponible");let r=await fetch("http://localhost:3000/training-plans",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({description:e})});if(!r.ok){let e=await r.json();throw console.error("Server error:",e),Error("Error: ".concat(r.status," ").concat(r.statusText))}let o=await r.json();return console.log("Server response",o),o}catch(e){return console.error("Error when creating plan",e),null}}async function n(e,t){try{let r=localStorage.getItem("token");if(!r)throw Error("Token no disponible");if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(t.type)||t.size>204800)throw Error("El archivo debe ser una imagen en formato jpg, jpeg, png o webp y menor a 200KB");let o=new FormData;o.append("file",t);let n=await fetch("http://localhost:3000/files/uploadImage/".concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(r)},body:o});if(!n.ok){let e=await n.json();throw console.error("Server error:",e),Error("Error: ".concat(n.status," ").concat(n.statusText))}let a=await n.json();return console.log("Server response",a),a}catch(e){return console.error("Error when uploading image",e),null}}r.d(t,{Ix:function(){return n},Wb:function(){return a},he:function(){return o},pE:function(){return s}});let a=async e=>{try{let t=localStorage.getItem("token"),r=await fetch("http://localhost:3000/training-plans/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}});if(!r.ok){let e=await r.text();throw Error("Error: ".concat(r.status," ").concat(r.statusText,", Details: ").concat(e))}return!0}catch(e){console.error("Error al eliminar el plan de entrenamiento:",e),alert("Error al eliminar el plan de entrenamiento")}},s=async()=>{try{let e=localStorage.getItem("token"),t=await fetch("http://localhost:3000/training-plans",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("Error: ".concat(t.status," ").concat(t.statusText));let r=await t.json();return console.log("Training plans data:",r),r}catch(e){console.error("Error obtaining training plans:",e),alert("Error obtaining training plans")}}},9261:function(e,t,r){async function o(e){try{if(!e.email||!e.password)return console.error("Email y contrase\xf1a son obligatorios"),null;let t=await fetch("http://localhost:3000/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw console.error("Error del servidor:",e),Error("Error: ".concat(t.status," ").concat(t.statusText))}return await t.json()}catch(e){return e instanceof Error?console.error("Error durante la solicitud de inicio de sesi\xf3n:",e.message):console.error("Error inesperado:",e),null}}async function n(e){try{console.log("Iniciando la solicitud de registro al backend");let t=await fetch("http://localhost:3000/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw console.error("Error del servidor:",e),Error("Error: ".concat(t.status," ").concat(t.statusText))}let r=await t.json();return console.log("Respuesta del servidor:",r),r}catch(e){return console.error("Error durante el registro:",e),null}}r.d(t,{FQ:function(){return l},J:function(){return n},Qd:function(){return o},Rf:function(){return a},wc:function(){return s}});let a=async()=>{let e=localStorage.getItem("token"),t=await fetch("http://localhost:3000/users",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(!t.ok){let e=await t.json();throw Error("HTTP error! Status: ".concat(t.status,", Message: ").concat(e.message))}return await t.json()},s=async(e,t)=>{let r=localStorage.getItem("token");if(!r)throw Error("Token no encontrado");let o=await fetch("http://localhost:3000/users/changeRole/".concat(e,"?role=").concat(t),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}});if(!o.ok)throw Error((await o.json()).message||"Error desconocido al cambiar el rol");return await o.json()},l=async(e,t)=>{try{let r=await fetch("http://localhost:3000/users/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}});if(r.ok)return await r.json();return console.error("Error fetching user data:",r.statusText),null}catch(e){return console.error("Error fetching user data:",e),null}}}}]);