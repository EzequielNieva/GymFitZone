"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[684],{2177:function(e,r,t){t.d(r,{S:function(){return d},d:function(){return g}});var o=t(7437),n=t(9261),a=t(2265),s=t(4474),l=t(5515),c=t.n(l),i=t(9376),u=t(605);let d=(0,a.createContext)({user:null,setUser:()=>{},isLogged:!1,setIsLogged:()=>{},signIn:async()=>!1,signUp:async e=>({success:!1,errorMessage:""}),logOut:()=>{},imgUrl:null,setImgUrl:()=>{}}),g=e=>{let{children:r}=e,[t,l]=(0,a.useState)(null),[g,f]=(0,a.useState)(!1),[p,m]=(0,a.useState)(null);(0,i.useRouter)();let{data:h,status:y}=(0,u.useSession)();console.log("\uD83D\uDE80 ~ UserProvider ~ status:",y),console.log("\uD83D\uDE80 ~ UserProvider ~ session:",h);let w=async e=>{try{let r;if("provider"in e)return!0;{let t=await (0,n.Qd)(e);r=t?{user:t.user,token:t.token}:null}if(r&&r.token){let e=(0,s.o)(r.token),t=e.roles,o=e.id,a={...r.user,role:t,id:o,token:r.token},c=await (0,n.FQ)(o,r.token);return c&&(l({...a,...c}),m(c.imgUrl||null),localStorage.setItem("imgUrl_".concat(o),c.imgUrl||"")),localStorage.setItem("user",JSON.stringify(a)),localStorage.setItem("token",r.token),f(!0),!0}return console.warn("No se pudo iniciar sesi\xf3n, datos no v\xe1lidos:",r),!1}catch(e){return e instanceof Error?console.error("Error durante el login:",e.message):console.error("Error inesperado durante el login:",e),!1}},b=async e=>{try{console.log("Llamando a postSignUp con:",e);let r=await (0,n.J)(e);if(console.log("Respuesta recibida en signUp:",r),r&&r.user&&r.user.id)return console.log("Usuario registrado correctamente:",r.user),await w({email:e.email,password:e.password}),m(r.user.imgUrl),{success:!0};return console.log("La respuesta no contiene el usuario o el ID:",r),{success:!1,errorMessage:"No se pudo obtener el ID del usuario."}}catch(e){return console.error("Error en signUp:",e),{success:!1,errorMessage:e instanceof Error?e.message:"Error desconocido en el registro"}}},v=async()=>{let e=null==t?void 0:t.id;e&&localStorage.removeItem("imgUrl_".concat(e)),localStorage.removeItem("user"),localStorage.removeItem("token"),c().fire({title:"Come back soon!",text:"You are logged out!",icon:"success",confirmButtonText:"Great",customClass:{popup:"bg-black text-white",title:"text-red-600",confirmButton:"bg-red-600 text-white hover:bg-red-700 py-2 px-4 border-none rounded-md"},buttonsStyling:!1}),l(null),f(!1),m(null)};return(0,a.useEffect)(()=>{let e=localStorage.getItem("user"),r=localStorage.getItem("token");if(e&&r){let t=JSON.parse(e);try{let e=(0,s.o)(r),o=e.roles,n=t.id,a=localStorage.getItem("imgUrl_".concat(n));l({...t,role:o,id:e.id}),m(a||null),f(!0)}catch(e){console.warn("Error al decodificar el token:",e)}}},[]),(0,o.jsx)(d.Provider,{value:{user:t,setUser:l,isLogged:g,setIsLogged:f,signIn:w,signUp:b,logOut:v,imgUrl:p,setImgUrl:m},children:r})}},9261:function(e,r,t){async function o(e){try{if(!e.email||!e.password)return console.error("Email y contrase\xf1a son obligatorios"),null;let r=await fetch("http://localhost:3000/auth/signin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json();throw console.error("Error del servidor:",e),Error("Error: ".concat(r.status," ").concat(r.statusText))}return await r.json()}catch(e){return e instanceof Error?console.error("Error durante la solicitud de inicio de sesi\xf3n:",e.message):console.error("Error inesperado:",e),null}}async function n(e){try{console.log("Iniciando la solicitud de registro al backend");let r=await fetch("http://localhost:3000/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json();throw console.error("Error del servidor:",e),Error("Error: ".concat(r.status," ").concat(r.statusText))}let t=await r.json();return console.log("Respuesta del servidor:",t),t}catch(e){return console.error("Error durante el registro:",e),null}}t.d(r,{FQ:function(){return l},J:function(){return n},Qd:function(){return o},Rf:function(){return a},wc:function(){return s}});let a=async()=>{let e=localStorage.getItem("token"),r=await fetch("http://localhost:3000/users",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(!r.ok){let e=await r.json();throw Error("HTTP error! Status: ".concat(r.status,", Message: ").concat(e.message))}return await r.json()},s=async(e,r)=>{let t=localStorage.getItem("token");if(!t)throw Error("Token no encontrado");let o=await fetch("http://localhost:3000/users/changeRole/".concat(e,"?role=").concat(r),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(!o.ok)throw Error((await o.json()).message||"Error desconocido al cambiar el rol");return await o.json()},l=async(e,r)=>{try{let t=await fetch("http://localhost:3000/users/".concat(e),{headers:{Authorization:"Bearer ".concat(r)}});if(t.ok)return await t.json();return console.error("Error fetching user data:",t.statusText),null}catch(e){return console.error("Error fetching user data:",e),null}}},6231:function(e,r,t){t.d(r,{w_:function(){return u}});var o=t(2265),n={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a=o.createContext&&o.createContext(n),s=["attr","size","title"];function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}function c(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function i(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?c(Object(t),!0).forEach(function(r){var o,n;o=r,n=t[r],(o=function(e){var r=function(e,r){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,r||"default");if("object"!=typeof o)return o;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==typeof r?r:r+""}(o))in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function u(e){return r=>o.createElement(d,l({attr:i({},e.attr)},r),function e(r){return r&&r.map((r,t)=>o.createElement(r.tag,i({key:t},r.attr),e(r.child)))}(e.child))}function d(e){var r=r=>{var t,{attr:n,size:a,title:c}=e,u=function(e,r){if(null==e)return{};var t,o,n=function(e,r){if(null==e)return{};var t={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(r.indexOf(o)>=0)continue;t[o]=e[o]}return t}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],!(r.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}(e,s),d=a||r.size||"1em";return r.className&&(t=r.className),e.className&&(t=(t?t+" ":"")+e.className),o.createElement("svg",l({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,n,u,{className:t,style:i(i({color:e.color||r.color},r.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),c&&o.createElement("title",null,c),e.children)};return void 0!==a?o.createElement(a.Consumer,null,e=>r(e)):r(n)}}}]);